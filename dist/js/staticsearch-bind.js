import{staticsearch as b}from"./__SSDIR__/staticsearch.js";var f="q",T=0,S="__AGENT__",g=Symbol(S),w=500,y={date:new Intl.DateTimeFormat([],{dateStyle:"long"}).format,number:new Intl.NumberFormat([],{maximumFractionDigits:0}).format};(()=>{let e=document.getElementById("staticsearch_search"),a=document.getElementById("staticsearch_result");a&&C(a,{minScore:a.getAttribute("minscore"),maxResults:a.getAttribute("maxresults")}),e&&e.tagName==="INPUT"&&x(e)})();function I(){return new URLSearchParams(location.search).get(f)||""}function v(e,a){let r=new URL(location);e?r.searchParams.set(f,e):r.searchParams.delete(f),r.hash=a||"",history.replaceState({},"",r.href)}function x(e){if(e[g])return;e[g]=!0,e.name&&(f=e.name);let a=I()||sessionStorage.getItem(S)||"";a&&(e.value=a);let r=e.value;r&&p(r);let m;e.addEventListener("input",n=>{let o=n.target.value;clearTimeout(m),m=setTimeout(()=>p(o),w)},!1);function p(n){sessionStorage.setItem(S,n),!(n.length<2)&&b.find(n).then(o=>{})}}function C(e,a={}){if(e[g])return;e[g]=!0;let r="",m=parseFloat(a.minScore)||0,p=parseFloat(a.maxResults)||0,n=a.resultElement||"ol",o=a.messageTemplate||document.getElementById("staticsearch_resultmessage");o||(o=document.createElement("template"),o.innerHTML='<p part="resultmessage"><span part="resultcount">0</span> found for <span part="searchterm"></span>&hellip;</p>');let h=a.itemTemplate||document.getElementById("staticsearch_item");h||(h=document.createElement("template"),h.innerHTML='<li part="item"><a part="link"><h2 part="title"></h2><p part="meta"><time part="date"></time> &ndash; <span part="words">0</span> words</p><p part="description"></p></a></li>'),e.addEventListener("click",i=>{let u=i.target.closest("a");u&&r&&v(r,u.id)}),document.addEventListener("staticsearch:result",i=>{r=i.detail.search;let u=i.detail.result;e.innerHTML="";let l=document.createElement(n);l.setAttribute("part","searchresult"),u.forEach((t,E)=>{if(m&&t.relevancy<m||p&&E>=p)return;let s=h.content.cloneNode(!0);c(s,"link",null,{href:t.url,id:`staticsearchresult-${t.id}`}),c(s,"title",t.title),c(s,"description",t.description),t.date&&c(s,"date",y.date(new Date(t.date)),{datetime:t.date}),t.words&&c(s,"words",y.number(t.words)),l.appendChild(s)});let d=o.content.cloneNode(!0);if(c(d,"resultcount",l.childElementCount),c(d,"searchterm",r),e.appendChild(d),e.appendChild(l),!T&&location.hash){let t=e.querySelector(location.hash);t&&(t.focus(),t.scrollIntoView({behavior:"smooth",block:"nearest"}))}else e.scrollTop=0;T++},!1);function c(i,u,l,d={}){i.querySelectorAll(`[part="${u}"]`).forEach(t=>{for(let[E,s]of Object.entries(d))t.setAttribute(E,s);if(l){for(;t.firstElementChild;)t=t.firstElementChild;t.textContent=l}})}}export{x as staticSearchInput,I as staticSearchQuery,C as staticSearchResult,v as staticSearchSetQuery};
